<section class="window" data-width="800px" data-height="600px" data-top="100px" data-left="10px"
    style="background-color: white;">
    <div style="width:100%;height:100%;background:white;color:white;">

        <div class="useful-toolbar" style="border-bottom: 1px solid rgba(51, 51, 51, 0.082);height: 25px;">
            <div style="display: flex;height: 100%;"><img src="./gnome-ico/close.svg" class="close-system-window"
                    style="width: 14px !important;"><img src="./gnome-ico/chgres.svg" class="chgres-system-window"><img
                    src="./gnome-ico/min.svg" class="min-system-window" style="width: 14px !important;"></div>
            <!-- Change Your Title-->
            <p class="title-system-0123" style="color:black;">File Explorer</p>
            <img src="./applications/fileloading/run.svg" class="appico-system-window-0123">
        </div>
        <div class="the-rest" style="overflow: auto;height: 96%;">
            <div class="movemento">
                <div class="path"><img src="./applications/fileloading/goback.svg"
                        style="margin-left:2px;margin-right: 10px;"><img src="./applications/fileloading/gofroward.svg"
                        style="margin-right: 10px;"><input type="text" class="path-inp" style="
                    width: 100%;
                    outline: 0;
                    border: 1px solid rgba(0, 0, 0, 0.2);
                    font-family: sans-serif;
                    font-size: 16px;
                    letter-spacing: 3px;
                    font-weight: bold;
                    border-radius: 5px;
                    padding-left: 10px;"></div>
            </div>
            <div style="display:flex;height: 90%;">
                <div class="menu" style="height: 100%;
                width: 215px;
                color: black;
                font-family: sans-serif;
                font-size: 12px;
                display: flex;
                flex-direction: column;">
                    <div style="    
                    display: flex;
                    align-items: center;"><img src="./applications/fileloading/download.svg" style="height:28px;    margin-right: 10px;
                                                                                                    margin-left: 10px;
"><h1>Downloads</h1></div>
                    <div style="    
                    display: flex;
                    align-items: center;"><img src="./applications/fileloading/sys.svg" style="height:28px;    margin-right: 10px;
                                                                                                    margin-left: 10px;
"><h1>System</h1></div>
                    <div style="    
                    display: flex;
                    align-items: center;"><img src="./applications/fileloading/camera.svg" style="height:28px;    margin-right: 10px;
                                                                                                    margin-left: 10px;
"><h1>Videos</h1></div>
                    <div style="    
                    display: flex;
                    align-items: center;"><img src="./applications/fileloading/photo.svg" style="height:28px;    margin-right: 10px;
                                                                                                    margin-left: 10px;
"><h1>Photos</h1></div>
                </div>
                <div class="dirs" style="    display: flex;
            flex-flow: wrap;height: min-content;"></div>
            </div>
        </div>
    </div>
    <script class="application-script">

        function main_window() {

            let cwd = '';

            async function getFolders(path) {
                const folders = await fetch(`/?path=${path}`, { method: "POST", headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ path: path }) })
                console.error(cwd)

                return folders;
            }
            async function first() {
                let root = await getFolders('./')
                let resp = await root.json()
                cwd = resp.cwd
                $('.path-inp').val(cwd.replace('./', '\\'));

                resp.dir.forEach(e => {
                    $('.dirs').append(`<div data-class='file' class='dir-0123'><img class='ico-sys-file-0123' src='./applications/fileloading/folder.svg'><p style='color:black;font-family:sans-serif;text-align: center; width: 120px;word-wrap: break-word;' class='dir-filesystem-0123'><b>${e}</b></p></div>`)
                });
                resp.file.forEach(e => {
                    $('.dirs').append(`<div data-class='file' class='file-0123'><img class='ico-sys-file-0123' src='./applications/fileloading/file.svg'><p style='color:black;font-family:sans-serif;text-align: center;width: 120px;word-wrap: break-word;' class='file-filesystem-0123'><b>${e}</b></p></div>`)

                })
            }
            first()
            console.error(cwd)
            $(document).on('click', '[data-class="file"]', function (event) {
                console.log('click');

                $('[data-class="file"]').find('p').find('b').css('background', 'transparent')
                $('[data-class="file"]').find('p').find('b').css('color', 'black')



                $(this).find('p').find('b').css('background', '#00f')

                $(this).find('p').find('b').css('color', 'white')
                $(this).find('p').find('b').css('border-radius', '5px')



            })
            $(document).off('dblclick', '[data-class="file"]').on('dblclick', '[data-class="file"]', async function () {
                if ($(this).attr('class') === 'dir-0123') {
                    const folder = $(this).text();



                    const data = await getFolders(`${cwd}\\${folder}`);
                    let resp = await data.json();

                    cwd = resp.cwd;
                    // تحديث مسار العرض
                    $('.path-inp').val('');  // مسح المسار السابق
                    console.clear()
                    console.log(cwd)
                    $('.path-inp').val(cwd.replace('./', ''));

                    console.log(resp);

                    // مسح المحتويات السابقة وإضافة المحتويات الجديدة
                    $('.dirs')[0].innerHTML = '';
                    resp.dir.forEach(e => {
                        $('.dirs').append(`<div data-class='file' class='dir-0123'><img class='ico-sys-file-0123' src='./applications/fileloading/folder.svg'><p style='color:black;font-family:sans-serif;text-align: center; width: 120px;word-wrap: break-word;' class='dir-filesystem-0123'><b>${e}</b></p></div>`)
                    });
                    resp.file.forEach(e => {
                        $('.dirs').append(`<div data-class='file' class='file-0123'><img class='ico-sys-file-0123' src='./applications/fileloading/file.svg'><p style='color:black;font-family:sans-serif;text-align: center;width: 120px;word-wrap: break-word;' class='file-filesystem-0123'><b>${e}</b></p></div>`)

                    })
                }
            });
            $('.path-inp').on('keypress', async function (event) {
                if (event.key == 'Enter') {
                    console.error(1, 1, $(this).val().split('')[0], $(this).val().split('')[0] == '\\' ? $(this).val().replace('\\', './') : $(this).val())
                    let resp = await getFolders($(this).val())
                    resp = await resp.json()
                    cwd = resp.cwd;
                    $('.path-inp').val($(this).val());

                    $('.dirs')[0].innerHTML = '';
                    resp.dir.forEach(e => {
                        $('.dirs').append(`<div data-class='file' class='dir-0123'><img class='ico-sys-file-0123' src='./applications/fileloading/folder.svg'><p style='color:black;font-family:sans-serif;text-align: center; width: 120px;word-wrap: break-word;' class='dir-filesystem-0123'><b>${e}</b></p></div>`)
                    });
                    resp.file.forEach(e => {
                        $('.dirs').append(`<div data-class='file' class='file-0123'><img class='ico-sys-file-0123' src='./applications/fileloading/file.svg'><p style='color:black;font-family:sans-serif;text-align: center;width: 120px;word-wrap: break-word;' class='file-filesystem-0123'><b>${e}</b></p></div>`)

                    })
                }
            })
        }


        main_window()
    </script>
</section>